input {
  udp {
    port => 514
    type => "syslog"
    codec => "json"
  }
}

filter {
  if [type] == "syslog" {
    # Ensure all required fields are properly renamed and at the root level
    mutate {
      rename => {
        "timestamp" => "log_timestamp"
        "process_name" => "process_name"
        "process_id" => "process_id"
        "action" => "action"
        "src_ip" => "src_ip"
        "dst_ip" => "dst_ip"
        "src_port" => "src_port"
        "dst_port" => "dst_port"
        "network_interface" => "network_interface"
        "direction" => "direction"
        "protocol" => "protocol"
      }
    }

    date {
      match => [ "log_timestamp", "MMM  d HH:mm:ss", "MMM dd HH:mm:ss" ]
      target => "@timestamp"
    }
  }
}

output {
  elasticsearch {
    hosts => ["elasticsearch:9200"]
    manage_template => false
    index => "syslog-%{+YYYY.MM.dd}"
  }

  stdout { codec => rubydebug }
}